<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Patient Record System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c7da0;
            --primary-dark: #1a5276;
            --secondary: #a9d6e5;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 50px;
        }

        /* Dashboard Styles */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .icon-admitted { background-color: var(--primary); }
        .icon-discharged { background-color: var(--success); }
        .icon-total { background-color: var(--warning); }
        .icon-today { background-color: var(--danger); }

        .stat-info h3 {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-info .number {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 5px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2.5fr;
            gap: 25px;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .menu {
            list-style: none;
        }

        .menu-item {
            padding: 18px 25px;
            border-bottom: 1px solid var(--light-gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .menu-item:hover, .menu-item.active {
            background-color: var(--secondary);
            color: var(--primary-dark);
        }

        .menu-item i {
            font-size: 1.2rem;
            width: 25px;
        }

        /* Content Area */
        .content-area {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
            min-height: 600px;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        .content-header h2 {
            color: var(--primary-dark);
            font-size: 1.5rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        /* Form Styles */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 125, 160, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background-color: var(--primary);
            color: white;
            text-align: left;
            padding: 15px;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
        }

        tr:hover {
            background-color: rgba(44, 125, 160, 0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-admitted {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }

        .status-discharged {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            border: none;
            background: none;
        }

        .edit-btn {
            color: var(--primary);
            background-color: rgba(44, 125, 160, 0.1);
        }

        .delete-btn {
            color: var(--danger);
            background-color: rgba(220, 53, 69, 0.1);
        }

        /* Search Styles */
        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .search-input {
            flex-grow: 1;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        .alert-info {
            background-color: rgba(44, 125, 160, 0.15);
            color: var(--primary);
            border-left: 4px solid var(--primary);
        }

        /* Footer */
        footer {
            margin-top: 40px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            padding: 20px 0;
            border-top: 1px solid var(--light-gray);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .search-container {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .content-area {
                padding: 20px;
            }
        }

        /* Hidden Class */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-hospital"></i>
                    <h1>Hospital Patient Record System</h1>
                </div>
                <div class="user-info">
                    <i class="fas fa-user-md"></i>
                    <span>Admin User</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-icon icon-admitted">
                    <i class="fas fa-procedures"></i>
                </div>
                <div class="stat-info">
                    <h3>Admitted</h3>
                    <div class="number">24</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-discharged">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-info">
                    <h3>Discharged</h3>
                    <div class="number">156</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-total">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3>Total Patients</h3>
                    <div class="number">180</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon icon-today">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <div class="stat-info">
                    <h3>Today's Admissions</h3>
                    <div class="number">3</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Sidebar Menu -->
            <div class="sidebar">
                <ul class="menu">
                    <li class="menu-item active" data-target="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </li>
                    <li class="menu-item" data-target="add-patient">
                        <i class="fas fa-user-plus"></i>
                        <span>Add New Patient</span>
                    </li>
                    <li class="menu-item" data-target="view-patients">
                        <i class="fas fa-users"></i>
                        <span>View All Patients</span>
                    </li>
                    <li class="menu-item" data-target="search-patient">
                        <i class="fas fa-search"></i>
                        <span>Search Patient</span>
                    </li>
                    <li class="menu-item" data-target="update-patient">
                        <i class="fas fa-edit"></i>
                        <span>Update Patient</span>
                    </li>
                    <li class="menu-item" data-target="admission-track">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Admission Tracking</span>
                    </li>
                    <li class="menu-item" data-target="discharge-patient">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Discharge Patient</span>
                    </li>
                </ul>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Content (Default) -->
                <div id="dashboard" class="content-section">
                    <div class="content-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                        <button class="btn btn-primary" id="refreshBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>System Status:</strong> Connected to hospital_db successfully. 
                            Last updated: <span id="lastUpdated">Just now</span>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <h3>Recent Admissions</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Condition</th>
                                    <th>Admission Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentPatients">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Patient Form -->
                <div id="add-patient" class="content-section hidden">
                    <div class="content-header">
                        <h2><i class="fas fa-user-plus"></i> Add New Patient</h2>
                        <button class="btn btn-primary" id="clearFormBtn">
                            <i class="fas fa-broom"></i> Clear Form
                        </button>
                    </div>
                    
                    <div class="form-container">
                        <form id="addPatientForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="patientName">Patient Name *</label>
                                    <input type="text" id="patientName" required>
                                </div>
                                <div class="form-group">
                                    <label for="patientAge">Age *</label>
                                    <input type="number" id="patientAge" min="0" max="120" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="patientGender">Gender *</label>
                                    <select id="patientGender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="patientContact">Contact Number *</label>
                                    <input type="tel" id="patientContact" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="patientAddress">Address</label>
                                <textarea id="patientAddress"></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="patientDisease">Disease/Condition *</label>
                                    <input type="text" id="patientDisease" required>
                                </div>
                                <div class="form-group">
                                    <label for="admissionDate">Admission Date</label>
                                    <input type="date" id="admissionDate">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-warning" id="cancelAddBtn">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Add Patient
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- View All Patients -->
                <div id="view-patients" class="content-section hidden">
                    <div class="content-header">
                        <h2><i class="fas fa-users"></i> All Patient Records</h2>
                        <button class="btn btn-primary" id="exportBtn">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                    
                    <div class="search-container">
                        <div class="search-input">
                            <input type="text" id="searchAllPatients" placeholder="Search patients by name or ID...">
                        </div>
                        <button class="btn btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Contact</th>
                                    <th>Disease</th>
                                    <th>Admission Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allPatientsTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Search Patient -->
                <div id="search-patient" class="content-section hidden">
                    <div class="content-header">
                        <h2><i class="fas fa-search"></i> Search Patient</h2>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Search By</label>
                                <div style="display: flex; gap: 15px; margin-top: 10px;">
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="searchType" value="id" checked> Patient ID
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" name="searchType" value="name"> Name
                                    </label>
                                </div>
                            </div>
                            <div class="form-group" id="searchIdGroup">
                                <label for="searchId">Patient ID</label>
                                <input type="number" id="searchId" min="1">
                            </div>
                            <div class="form-group hidden" id="searchNameGroup">
                                <label for="searchName">Patient Name</label>
                                <input type="text" id="searchName">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" id="searchPatientBtn">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                    
                    <div id="searchResults" class="hidden">
                        <h3 style="margin-top: 30px;">Search Results</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Age</th>
                                        <th>Gender</th>
                                        <th>Contact</th>
                                        <th>Disease</th>
                                        <th>Admission Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="searchResultsTable">
                                    <!-- Filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Update Patient -->
                <div id="update-patient" class="content-section hidden">
                    <div class="content-header">
                        <h2><i class="fas fa-edit"></i> Update Patient Details</h2>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>Enter Patient ID to load current details for updating.</div>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="updatePatientId">Patient ID *</label>
                                <input type="number" id="updatePatientId" min="1">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" style="margin-top: 25px;" id="loadPatientBtn">
                                    <i class="fas fa-user-check"></i> Load Patient
                                </button>
                            </div>
                        </div>
                        
                        <form id="updatePatientForm" class="hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="updateName">Patient Name</label>
                                    <input type="text" id="updateName">
                                </div>
                                <div class="form-group">
                                    <label for="updateAge">Age</label>
                                    <input type="number" id="updateAge" min="0" max="120">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="updateContact">Contact Number</label>
                                    <input type="tel" id="updateContact">
                                </div>
                                <div class="form-group">
                                    <label for="updateDisease">Disease/Condition</label>
                                    <input type="text" id="updateDisease">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="updateAddress">Address</label>
                                <textarea id="updateAddress"></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="updateStatus">Status</label>
                                    <select id="updateStatus">
                                        <option value="">Select Status</option>
                                        <option value="Admitted">Admitted</option>
                                        <option value="Discharged">Discharged</option>
                                    </select>
                                </div>
                                <div class="form-group" id="dischargeDateGroup" class="hidden">
                                    <label for="dischargeDate">Discharge Date</label>
                                    <input type="date" id="dischargeDate">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-warning" id="cancelUpdateBtn">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Update Patient
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Admission Tracking -->
                <div id="admission-track" class="content-section hidden">
                    <div class="content-header">
                        <h2><i class="fas fa-clipboard-list"></i> Admission & Discharge Tracking</h2>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <button class="btn btn-primary" id="showAdmittedBtn">
                            <i class="fas fa-procedures"></i> Admitted Patients
                        </button>
                        <button class="btn btn-success" id="showDischargedBtn">
                            <i class="fas fa-user-check"></i> Discharged Patients
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <h3 id="trackingTitle">Admitted Patients</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Disease</th>
                                    <th>Admission Date</th>
                                    <th>Days Admitted</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="trackingTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Discharge Patient -->
                <div id="discharge-patient" class="content-section hidden">
                    <div class="content-header">
                        <h2><i class="fas fa-sign-out-alt"></i> Discharge Patient</h2>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dischargePatientId">Patient ID *</label>
                                <input type="number" id="dischargePatientId" min="1">
                            </div>
                            <div class="form-group">
                                <label for="dischargeDateInput">Discharge Date</label>
                                <input type="date" id="dischargeDateInput">
                            </div>
                        </div>
                        
                        <div id="dischargePatientInfo" class="hidden">
                            <div class="alert alert-info">
                                <i class="fas fa-user-injured"></i>
                                <div>
                                    <strong>Patient Details:</strong>
                                    <div id="patientDetails">Loading...</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" id="checkPatientBtn">
                                <i class="fas fa-search"></i> Check Patient
                            </button>
                            <button class="btn btn-success hidden" id="confirmDischargeBtn">
                                <i class="fas fa-check-circle"></i> Confirm Discharge
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Hospital Patient Record System &copy; 2023 | Connected to MySQL Database: hospital_db</p>
            <p>This is a frontend interface. Backend integration with Python/MySQL is required for full functionality.</p>
        </div>
    </footer>

// Update the JavaScript section in your HTML file with this:

<script>
    // API Base URL
    const API_BASE_URL = 'http://localhost:5000/api';
    
    // DOM Elements
    const menuItems = document.querySelectorAll('.menu-item');
    const contentSections = document.querySelectorAll('.content-section');
    const recentPatientsTable = document.getElementById('recentPatients');
    const allPatientsTable = document.getElementById('allPatientsTable');
    const searchResultsTable = document.getElementById('searchResultsTable');
    const trackingTable = document.getElementById('trackingTable');
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        // Set current date for date inputs
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('admissionDate').value = today;
        document.getElementById('dischargeDateInput').value = today;
        document.getElementById('dischargeDate').value = today;
        
        // Load dashboard data
        loadDashboardData();
        
        // Set up event listeners
        setupEventListeners();
    });
    
    // Load dashboard data
    async function loadDashboardData() {
        try {
            // Load stats
            const statsResponse = await fetch(`${API_BASE_URL}/stats`);
            const stats = await statsResponse.json();
            
            // Update dashboard stats
            document.querySelector('.stat-card:nth-child(1) .number').textContent = stats.admitted;
            document.querySelector('.stat-card:nth-child(2) .number').textContent = stats.discharged;
            document.querySelector('.stat-card:nth-child(3) .number').textContent = stats.total_patients;
            document.querySelector('.stat-card:nth-child(4) .number').textContent = stats.today_admissions;
            
            // Update last updated time
            document.getElementById('lastUpdated').textContent = `Today at ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            
            // Load recent patients
            const patientsResponse = await fetch(`${API_BASE_URL}/patients?limit=4`);
            const patientsData = await patientsResponse.json();
            populateRecentPatients(patientsData.patients);
            
        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showAlert('error', 'Failed to load dashboard data. Please check if the backend server is running.');
        }
    }
    
    // Populate recent patients table
    function populateRecentPatients(patients) {
        recentPatientsTable.innerHTML = '';
        
        if (patients.length === 0) {
            recentPatientsTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">No patients found</td></tr>';
            return;
        }
        
        patients.forEach(patient => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${patient.id}</td>
                <td>${patient.patient_name}</td>
                <td>${patient.age}</td>
                <td>${patient.gender}</td>
                <td>${patient.disease}</td>
                <td>${patient.admission_date}</td>
                <td><span class="status-badge ${patient.status === 'Admitted' ? 'status-admitted' : 'status-discharged'}">${patient.status}</span></td>
            `;
            recentPatientsTable.appendChild(row);
        });
    }
    
    // Populate all patients table
    async function populateAllPatients(searchQuery = '') {
        try {
            let url = `${API_BASE_URL}/patients`;
            if (searchQuery) {
                url += `?search=${encodeURIComponent(searchQuery)}`;
            }
            
            const response = await fetch(url);
            const data = await response.json();
            
            allPatientsTable.innerHTML = '';
            
            if (data.patients.length === 0) {
                allPatientsTable.innerHTML = '<tr><td colspan="9" style="text-align: center;">No patients found</td></tr>';
                return;
            }
            
            data.patients.forEach(patient => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${patient.id}</td>
                    <td>${patient.patient_name}</td>
                    <td>${patient.age}</td>
                    <td>${patient.gender}</td>
                    <td>${patient.contact}</td>
                    <td>${patient.disease}</td>
                    <td>${patient.admission_date}</td>
                    <td><span class="status-badge ${patient.status === 'Admitted' ? 'status-admitted' : 'status-discharged'}">${patient.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit-btn" onclick="editPatient(${patient.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete-btn" onclick="deletePatient(${patient.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                `;
                allPatientsTable.appendChild(row);
            });
        } catch (error) {
            console.error('Error loading patients:', error);
            showAlert('error', 'Failed to load patients. Please try again.');
        }
    }
    
    // Set up event listeners
    function setupEventListeners() {
        // Menu navigation
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                
                // Update active menu item
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding section
                contentSections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                document.getElementById(targetId).classList.remove('hidden');
                
                // Special handling for certain sections
                if (targetId === 'view-patients') {
                    populateAllPatients();
                } else if (targetId === 'admission-track') {
                    showAdmittedPatients();
                }
            });
        });
        
        // Add patient form
        document.getElementById('addPatientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const patientData = {
                patient_name: document.getElementById('patientName').value,
                age: parseInt(document.getElementById('patientAge').value),
                gender: document.getElementById('patientGender').value,
                contact: document.getElementById('patientContact').value,
                address: document.getElementById('patientAddress').value,
                disease: document.getElementById('patientDisease').value,
                admission_date: document.getElementById('admissionDate').value || new Date().toISOString().split('T')[0]
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/patients`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(patientData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('success', `Patient added successfully! Patient ID: ${result.patient_id}`);
                    this.reset();
                    document.getElementById('admissionDate').value = new Date().toISOString().split('T')[0];
                    loadDashboardData(); // Refresh dashboard
                } else {
                    showAlert('error', result.error || 'Failed to add patient');
                }
            } catch (error) {
                console.error('Error adding patient:', error);
                showAlert('error', 'Failed to add patient. Please check connection.');
            }
        });
        
        // Clear form button
        document.getElementById('clearFormBtn').addEventListener('click', function() {
            document.getElementById('addPatientForm').reset();
            document.getElementById('admissionDate').value = new Date().toISOString().split('T')[0];
        });
        
        // Cancel add button
        document.getElementById('cancelAddBtn').addEventListener('click', function() {
            document.getElementById('addPatientForm').reset();
            document.getElementById('admissionDate').value = new Date().toISOString().split('T')[0];
            // Go back to dashboard
            menuItems.forEach(i => i.classList.remove('active'));
            menuItems[0].classList.add('active');
            
            contentSections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById('dashboard').classList.remove('hidden');
        });
        
        // Search type toggle
        document.querySelectorAll('input[name="searchType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const searchType = this.value;
                if (searchType === 'id') {
                    document.getElementById('searchIdGroup').classList.remove('hidden');
                    document.getElementById('searchNameGroup').classList.add('hidden');
                } else {
                    document.getElementById('searchIdGroup').classList.add('hidden');
                    document.getElementById('searchNameGroup').classList.remove('hidden');
                }
            });
        });
        
        // Search patient button
        document.getElementById('searchPatientBtn').addEventListener('click', async function() {
            const searchType = document.querySelector('input[name="searchType"]:checked').value;
            const searchId = document.getElementById('searchId').value;
            const searchName = document.getElementById('searchName').value;
            
            let query = '';
            if (searchType === 'id' && searchId) {
                query = searchId;
            } else if (searchType === 'name' && searchName) {
                query = searchName;
            }
            
            if (!query) {
                showAlert('warning', 'Please enter search criteria');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/patients/search/${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (response.ok) {
                    displaySearchResults(data.patients);
                } else {
                    showAlert('error', data.error || 'Search failed');
                }
            } catch (error) {
                console.error('Error searching:', error);
                showAlert('error', 'Search failed. Please try again.');
            }
        });
        
        // Search all patients input
        document.getElementById('searchAllPatients').addEventListener('input', function(e) {
            const searchQuery = e.target.value;
            if (searchQuery.length > 2 || searchQuery.length === 0) {
                populateAllPatients(searchQuery);
            }
        });
        
        // Load patient for update
        document.getElementById('loadPatientBtn').addEventListener('click', async function() {
            const patientId = document.getElementById('updatePatientId').value;
            
            if (!patientId) {
                showAlert('warning', 'Please enter a patient ID');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/patients/${patientId}`);
                const patient = await response.json();
                
                if (response.ok) {
                    // Populate form
                    document.getElementById('updateName').value = patient.patient_name;
                    document.getElementById('updateAge').value = patient.age;
                    document.getElementById('updateContact').value = patient.contact;
                    document.getElementById('updateDisease').value = patient.disease;
                    document.getElementById('updateAddress').value = patient.address || '';
                    document.getElementById('updateStatus').value = patient.status;
                    
                    // Show form
                    document.getElementById('updatePatientForm').classList.remove('hidden');
                    
                    showAlert('success', `Loaded patient: ${patient.patient_name}`);
                } else {
                    showAlert('error', patient.error || 'Patient not found');
                }
            } catch (error) {
                console.error('Error loading patient:', error);
                showAlert('error', 'Failed to load patient');
            }
        });
        
        // Update patient form
        document.getElementById('updatePatientForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const patientId = document.getElementById('updatePatientId').value;
            const updateData = {
                patient_name: document.getElementById('updateName').value,
                age: parseInt(document.getElementById('updateAge').value),
                contact: document.getElementById('updateContact').value,
                disease: document.getElementById('updateDisease').value,
                address: document.getElementById('updateAddress').value,
                status: document.getElementById('updateStatus').value
            };
            
            // Add discharge date if status is Discharged
            if (updateData.status === 'Discharged') {
                updateData.discharge_date = document.getElementById('dischargeDate').value || new Date().toISOString().split('T')[0];
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/patients/${patientId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('success', 'Patient details updated successfully!');
                    document.getElementById('updatePatientForm').classList.add('hidden');
                    document.getElementById('updatePatientId').value = '';
                    loadDashboardData(); // Refresh dashboard
                } else {
                    showAlert('error', result.error || 'Failed to update patient');
                }
            } catch (error) {
                console.error('Error updating patient:', error);
                showAlert('error', 'Failed to update patient');
            }
        });
        
        // Cancel update button
        document.getElementById('cancelUpdateBtn').addEventListener('click', function() {
            document.getElementById('updatePatientForm').classList.add('hidden');
            document.getElementById('updatePatientId').value = '';
        });
        
        // Status change in update form
        document.getElementById('updateStatus').addEventListener('change', function() {
            if (this.value === 'Discharged') {
                document.getElementById('dischargeDateGroup').classList.remove('hidden');
            } else {
                document.getElementById('dischargeDateGroup').classList.add('hidden');
            }
        });
        
        // Admission tracking buttons
        document.getElementById('showAdmittedBtn').addEventListener('click', showAdmittedPatients);
        document.getElementById('showDischargedBtn').addEventListener('click', showDischargedPatients);
        
        // Check patient for discharge
        document.getElementById('checkPatientBtn').addEventListener('click', async function() {
            const patientId = document.getElementById('dischargePatientId').value;
            
            if (!patientId) {
                showAlert('warning', 'Please enter a patient ID');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/patients/${patientId}`);
                const patient = await response.json();
                
                if (response.ok) {
                    if (patient.status === 'Discharged') {
                        showAlert('warning', 'Patient is already discharged!');
                        return;
                    }
                    
                    // Show patient info
                    document.getElementById('patientDetails').innerHTML = `
                        <strong>Name:</strong> ${patient.patient_name}<br>
                        <strong>Age:</strong> ${patient.age}<br>
                        <strong>Gender:</strong> ${patient.gender}<br>
                        <strong>Condition:</strong> ${patient.disease}<br>
                        <strong>Admitted on:</strong> ${patient.admission_date}
                    `;
                    
                    document.getElementById('dischargePatientInfo').classList.remove('hidden');
                    document.getElementById('confirmDischargeBtn').classList.remove('hidden');
                } else {
                    showAlert('error', patient.error || 'Patient not found');
                }
            } catch (error) {
                console.error('Error checking patient:', error);
                showAlert('error', 'Failed to check patient');
            }
        });
        
        // Confirm discharge
        document.getElementById('confirmDischargeBtn').addEventListener('click', async function() {
            const patientId = document.getElementById('dischargePatientId').value;
            const dischargeDate = document.getElementById('dischargeDateInput').value || new Date().toISOString().split('T')[0];
            
            try {
                const response = await fetch(`${API_BASE_URL}/patients/${patientId}/discharge`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ discharge_date: dischargeDate })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('success', `Patient discharged successfully on ${dischargeDate}`);
                    document.getElementById('dischargePatientId').value = '';
                    document.getElementById('dischargePatientInfo').classList.add('hidden');
                    this.classList.add('hidden');
                    loadDashboardData(); // Refresh dashboard
                } else {
                    showAlert('error', result.error || 'Failed to discharge patient');
                }
            } catch (error) {
                console.error('Error discharging patient:', error);
                showAlert('error', 'Failed to discharge patient');
            }
        });
        
        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
            loadDashboardData();
            showAlert('info', 'Data refreshed successfully!');
        });
    }
    
    // Display search results
    function displaySearchResults(patients) {
        const resultsContainer = document.getElementById('searchResults');
        const resultsTable = document.getElementById('searchResultsTable');
        
        resultsTable.innerHTML = '';
        
        if (patients.length === 0) {
            resultsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No patients found</td></tr>';
        } else {
            patients.forEach(patient => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${patient.id}</td>
                    <td>${patient.patient_name}</td>
                    <td>${patient.age}</td>
                    <td>${patient.gender}</td>
                    <td>${patient.contact}</td>
                    <td>${patient.disease}</td>
                    <td>${patient.admission_date}</td>
                    <td><span class="status-badge ${patient.status === 'Admitted' ? 'status-admitted' : 'status-discharged'}">${patient.status}</span></td>
                `;
                resultsTable.appendChild(row);
            });
        }
        
        resultsContainer.classList.remove('hidden');
    }
    
    // Show admitted patients
    async function showAdmittedPatients() {
        try {
            const response = await fetch(`${API_BASE_URL}/patients/status/admitted`);
            const data = await response.json();
            
            if (response.ok) {
                document.getElementById('trackingTitle').textContent = `Admitted Patients (${data.count})`;
                populateTrackingTable(data.patients);
            } else {
                showAlert('error', data.error || 'Failed to load admitted patients');
            }
        } catch (error) {
            console.error('Error loading admitted patients:', error);
            showAlert('error', 'Failed to load admitted patients');
        }
    }
    
    // Show discharged patients
    async function showDischargedPatients() {
        try {
            const response = await fetch(`${API_BASE_URL}/patients/status/discharged`);
            const data = await response.json();
            
            if (response.ok) {
                document.getElementById('trackingTitle').textContent = `Discharged Patients (${data.count})`;
                populateTrackingTable(data.patients);
            } else {
                showAlert('error', data.error || 'Failed to load discharged patients');
            }
        } catch (error) {
            console.error('Error loading discharged patients:', error);
            showAlert('error', 'Failed to load discharged patients');
        }
    }
    
    // Populate tracking table
    function populateTrackingTable(patients) {
        trackingTable.innerHTML = '';
        
        if (patients.length === 0) {
            trackingTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">No patients found</td></tr>';
            return;
        }
        
        patients.forEach(patient => {
            const row = document.createElement('tr');
            
            // Calculate days admitted if still admitted
            let daysAdmitted = 'N/A';
            if (patient.status === 'Admitted' && patient.admission_date) {
                const admissionDate = new Date(patient.admission_date);
                const today = new Date();
                daysAdmitted = Math.floor((today - admissionDate) / (1000 * 60 * 60 * 24));
            }
            
            row.innerHTML = `
                <td>${patient.id}</td>
                <td>${patient.patient_name}</td>
                <td>${patient.age}</td>
                <td>${patient.gender}</td>
                <td>${patient.disease}</td>
                <td>${patient.admission_date}</td>
                <td>${patient.status === 'Admitted' ? daysAdmitted : 'N/A'}</td>
                <td><span class="status-badge ${patient.status === 'Admitted' ? 'status-admitted' : 'status-discharged'}">${patient.status}</span></td>
            `;
            trackingTable.appendChild(row);
        });
    }
    
    // Edit patient function
    async function editPatient(patientId) {
        // Navigate to update section
        menuItems.forEach(i => i.classList.remove('active'));
        menuItems[4].classList.add('active'); // Update Patient menu item
        
        contentSections.forEach(section => {
            section.classList.add('hidden');
        });
        document.getElementById('update-patient').classList.remove('hidden');
        
        // Load patient data
        document.getElementById('updatePatientId').value = patientId;
        
        try {
            const response = await fetch(`${API_BASE_URL}/patients/${patientId}`);
            const patient = await response.json();
            
            if (response.ok) {
                // Populate form
                document.getElementById('updateName').value = patient.patient_name;
                document.getElementById('updateAge').value = patient.age;
                document.getElementById('updateContact').value = patient.contact;
                document.getElementById('updateDisease').value = patient.disease;
                document.getElementById('updateAddress').value = patient.address || '';
                document.getElementById('updateStatus').value = patient.status;
                
                // Show/hide discharge date based on status
                if (patient.status === 'Discharged') {
                    document.getElementById('dischargeDateGroup').classList.remove('hidden');
                    document.getElementById('dischargeDate').value = patient.discharge_date || new Date().toISOString().split('T')[0];
                } else {
                    document.getElementById('dischargeDateGroup').classList.add('hidden');
                }
                
                // Show form
                document.getElementById('updatePatientForm').classList.remove('hidden');
                
                showAlert('success', `Loaded patient: ${patient.patient_name}`);
            } else {
                showAlert('error', patient.error || 'Failed to load patient');
            }
        } catch (error) {
            console.error('Error loading patient:', error);
            showAlert('error', 'Failed to load patient');
        }
    }
    
    // Delete patient function
    async function deletePatient(patientId) {
        if (!confirm('Are you sure you want to delete this patient?')) {
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE_URL}/patients/${patientId}`, {
                method: 'DELETE'
            });
            
            const result = await response.json();
            
            if (response.ok) {
                showAlert('success', result.message);
                populateAllPatients(); // Refresh the table
                loadDashboardData(); // Refresh dashboard
            } else {
                showAlert('error', result.error || 'Failed to delete patient');
            }
        } catch (error) {
            console.error('Error deleting patient:', error);
            showAlert('error', 'Failed to delete patient');
        }
    }
    
    // Show alert function
    function showAlert(type, message) {
        // Remove any existing alerts
        const existingAlert = document.querySelector('.alert-floating');
        if (existingAlert) {
            existingAlert.remove();
        }
        
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-floating`;
        alertDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;
        
        const icon = type === 'success' ? 'check-circle' : 
                     type === 'error' ? 'exclamation-circle' : 
                     type === 'warning' ? 'exclamation-triangle' : 'info-circle';
        
        alertDiv.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <div>${message}</div>
            <button onclick="this.parentElement.remove()" style="margin-left: auto; background: none; border: none; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        document.body.appendChild(alertDiv);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentElement) {
                alertDiv.remove();
            }
        }, 5000);
    }
</script>
</body>
</html>